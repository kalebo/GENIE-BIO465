---
title: "GENIE Data Exploration"
author: "Kaleb Olson"
date: "March 1, 2017"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(dplyr)
library(magrittr)
library(ggbiplot)
library(readr)
library(synapseClient)
synapseLogin()
```

## CNA Segment Data Exploration

First we get the data file from synapse and read it in. Because synapse checks if the file is in the cache before downloading.
```{r}
cnafile <- synGet('syn7851253')
cna <- read_tsv(cnafile@filePath)
```
Let's look at the structure of the tbl...
```{r}
str(cna)
```

Here we are looking at the count of mutations across each of the chromosomes.

The X chromosome forces the column to a string so natural ordering is not followed. Also note the odd inclusion of chromosomes 23 and 24.
```{r}
cna %>% arrange(CHROM) %>% ggplot(aes(x=CHROM)) + geom_bar()
```

I'm not sure what we are looking at here.
```{r}
cna %>% ggplot(aes(x=LOC.START)) + geom_density()
cna %>% ggplot(aes(x=LOC.END)) + geom_density() 
cna %>% ggplot(aes(x=LOC.START)) + geom_density() + facet_wrap(~ CHROM)
```

Let's add a column to represent the difference between start and end in the data for each row.
```{r}
cna <- mutate(cna, SEDIFF = LOC.END - LOC.START)
```
And I'm not sure what we're looking at here.
```{r}
sample_n(cna, 9000) %>% ggplot(aes(y=SEDIFF, x=LOC.START)) + geom_density2d() + geom_rug() 
cna %>% ggplot(aes(y=SEDIFF, x=LOC.START)) + geom_density2d() + geom_rug() + facet_wrap(~ CHROM)
```
```{r}
cna %>% filter() %>% ggplot(aes(x=CHROM, y=SEDIFF)) + geom_boxplot() + j
```
### PCA
Let's experiment with PCA on just the continuous variables
```{r}
cna.pca <- cna %>% select(LOC.START, LOC.END, NUM.MARK, SEG.MEAN, SEDIFF) %>% prcomp( center = TRUE, scale. = TRUE) 
```

When we plot the varience explained by each principle componant it doesn't have the look we really wanted... And in the summary we see that PC1 and PC2 can only explain 73% of the variance.
```{r}
plot(cna.pca, type="l")
summary(cna.pca)
```
Plotting the PCA just for kicks anyway...
```{r}
cna.pca %>% ggbiplot(obs.scale = 1, var.scale = 2, group=cna$CHROM, ellipse = TRUE,  
              circle = FALSE, alpha = 1/10) +
            scale_color_discrete(name = '') +
            theme(legend.direction = 'horizontal', legend.position = 'top')
```

